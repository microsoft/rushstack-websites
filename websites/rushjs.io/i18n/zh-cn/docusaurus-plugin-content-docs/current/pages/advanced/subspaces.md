---
title: Rush å­ç©ºé—´
---

## ä»€ä¹ˆæ˜¯å­ç©ºé—´ï¼Ÿ

å­ç©ºé—´æ˜¯ Rush çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä½¿å•ä¸€çš„ monorepo èƒ½å¤Ÿä½¿ç”¨å¤šä¸ª PNPM é”å®šæ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå­ç©ºé—´åç§°æ˜¯ `my-team`ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹ `common/config/subspaces/my-team/`ï¼Œå…¶ä¸­åŒ…å« `pnpm-lock.yaml` æ–‡ä»¶å’Œç›¸å…³é…ç½®ã€‚æ¯ä¸ª Rush é¡¹ç›®éƒ½åªå±äºä¸€ä¸ªå­ç©ºé—´ï¼Œmonorepo ä»ç„¶ä¿æŒä¸€ä¸ªç»Ÿä¸€çš„ "å·¥ä½œåŒº"ã€‚å› æ­¤ï¼Œä¸€ä¸ªé¡¹ç›®çš„ `package.json` æ–‡ä»¶å¯ä»¥ä½¿ç”¨ `workspace:` æ¥æŒ‡å®šå¯¹å…¶ä»–å­ç©ºé—´é¡¹ç›®çš„ä¾èµ–ã€‚

## æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ

é€šå¸¸æƒ…å†µä¸‹ï¼Œæ•´ä¸ª monorepo ä½¿ç”¨å•ä¸ªé”å®šæ–‡ä»¶æ˜¯æœ€å¥½çš„ï¼Œå› ä¸ºè¿™å¯ä»¥ä¼˜åŒ–å®‰è£…æ—¶é—´ï¼Œå¹¶æœ€å¤§é™åº¦åœ°å‡å°‘ç®¡ç†ç‰ˆæœ¬å†²çªçš„ç»´æŠ¤å·¥ä½œã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå…è®¸å¤šä¸ªé”å®šæ–‡ä»¶æœ‰å…¶ä¼˜åŠ¿ï¼š

- **éå¸¸åºå¤§çš„ä»£ç åº“**ï¼šé”å®šæ–‡ä»¶å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªåºå¤§çš„å¤šå˜é‡æ–¹ç¨‹ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨è®¸å¤šé¡¹ç›®ä¸­åè°ƒ NPM åŒ…ç‰ˆæœ¬é€‰æ‹©æ¥æ¶ˆé™¤å†²çªå¹¶å°½é‡å‡å°‘é‡å¤ã€‚ï¼ˆ[é”å®šæ–‡ä»¶æµè§ˆå™¨](@lfx/) æ–‡æ¡£å¯¹æ­¤æœ‰è¯¦ç»†è¯´æ˜ã€‚ï¼‰å°† monorepo çš„ä¾èµ–å…³ç³»åˆ†æˆè¾ƒå°çš„é”å®šæ–‡ä»¶ç¡®å®ä½¿è¿™äº›æ–¹ç¨‹æ›´å°ã€æ›´å®¹æ˜“è§£å†³ï¼Œä½†å¢åŠ äº†ç®¡ç†ç‰ˆæœ¬çš„æ•´ä½“å¼€é”€ã€‚å¯¹äºåºå¤§çš„å·¥ç¨‹å›¢é˜Ÿæ¥è¯´ï¼Œåˆ†å·¥æ¯”å‡å°‘å·¥ä½œæ€»é‡æ›´é‡è¦ã€‚

- **è§£è€¦çš„é¡¹ç›®é›†åˆ**ï¼šä¸€ä¸ªåºå¤§çš„ä»£ç åº“ä¸­å¯èƒ½æœ‰ä¸€äº›é¡¹ç›®é›†ï¼Œå®ƒä»¬çš„ä¾èµ–å…³ç³»ä¸ä»£ç åº“çš„å…¶ä»–éƒ¨åˆ†ä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ 50 ä¸ªé¡¹ç›®æ„æˆä¸€ä¸ªä½¿ç”¨å·²å¼ƒç”¨æˆ–è¿‡æ—¶æ¡†æ¶çš„é—ç•™åº”ç”¨ç¨‹åºï¼Œæ²¡æœ‰ä¸šåŠ¡åŠ¨æœºå»ç°ä»£åŒ–ã€‚å°†è¿™äº›é¡¹ç›®ç§»å…¥ä¸€ä¸ªå­ç©ºé—´å¯ä»¥ä½¿å…¶ç‰ˆæœ¬ç®¡ç†ç‹¬ç«‹ã€‚

- **å®‰è£…æµ‹è¯•**ï¼šåœ¨å‘å¸ƒ NPM åŒ…æ—¶ï¼Œä½¿ç”¨ `workspace:*` ç¬¦å·é“¾æ¥æ— æ³•é‡ç°æŸäº›é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¹½çµä¾èµ–æˆ–é”™è¯¯çš„ `.npmignore` é€šé…ç¬¦ä¼šå¯¼è‡´å¤–éƒ¨æ¶ˆè´¹è€…çš„åŒ…å¤±è´¥ï¼Œä½†åœ¨ monorepo ä¸­æµ‹è¯•åŒä¸€åº“æ—¶å¯èƒ½å·¥ä½œæ­£å¸¸ã€‚å°†æµ‹è¯•é¡¹ç›®ç§»å…¥å­ç©ºé—´ï¼ˆç»“åˆ[æ³¨å…¥ä¾èµ–](./injected_deps.md)ï¼‰ä¼šäº§ç”Ÿæ›´å‡†ç¡®çš„å®‰è£…ï¼Œä»è€Œå‘ç°æ­¤ç±»é—®é¢˜ï¼ŒåŒæ—¶é¿å…å®é™…å‘å¸ƒåˆ°æµ‹è¯• NPM æ³¨å†Œè¡¨çš„å¼€é”€ã€‚

## æˆ‘éœ€è¦å¤šå°‘ä¸ªå­ç©ºé—´ï¼Ÿ

æˆ‘ä»¬é€šå¸¸å»ºè®® "å°½å¯èƒ½å°‘" ä»¥å°½é‡å‡å°‘é¢å¤–çš„ç‰ˆæœ¬ç®¡ç†å¼€é”€ã€‚_æ¯ä¸ªå›¢é˜Ÿä¸€ä¸ªå­ç©ºé—´_ æ˜¯ä¸€ä¸ªåˆç†çš„æœ€å¤§ä¸Šé™ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨ä¸€ä¸ªåŒ…å«è¶…è¿‡ 1000 ä¸ªå­ç©ºé—´çš„ç”Ÿäº§ç¯å¢ƒçš„ monorepo ä¸­ï¼Œè¯¥åŠŸèƒ½å·²è¢«æˆåŠŸä½¿ç”¨ã€‚

> **çœŸå®ä¸–ç•Œç¤ºä¾‹**
>
> Rush Stack åœ¨ GitHub ä¸Šçš„è‡ªæœ‰ä»“åº“ç›®å‰é…ç½®äº†ä¸¤ä¸ªå­ç©ºé—´ï¼š
>
> - [common/config/subspaces/build-tests-subspace](https://github.com/microsoft/rushstack/tree/main/common/config/subspaces/build-tests-subspace): ç”¨äºæµ‹è¯•å‘å¸ƒçš„ NPM åŒ…çš„å®‰è£…
> - [common/config/subspaces/default](https://github.com/microsoft/rushstack/tree/main/common/config/subspaces/default): åŒ…å«æ‰€æœ‰å…¶ä»–é¡¹ç›®

## åŠŸèƒ½è®¾è®¡

æ¯ä¸ªå­ç©ºé—´å¿…é¡»åœ¨ [common/config/subspaces.json](../configs/subspaces_json.md) é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¸­å¤®æ³¨å†Œã€‚é¡¹ç›®é€šè¿‡ [rush.json](../configs/rush_json.md) ä¸­çš„ `subspaceName` å­—æ®µæ·»åŠ åˆ°å­ç©ºé—´ã€‚

æ¯ä¸ªå­ç©ºé—´çš„é…ç½®ä½äºæ–‡ä»¶å¤¹ `common/config/subspaces/<subspace-name>/` ä¸­ï¼Œå¯èƒ½åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

| æ–‡ä»¶                                                         | ä½œç”¨                                                                                        |
| ------------------------------------------------------------ | ------------------------------------------------------------------------------------------- |
| [`common-versions.json`](../configs/common-versions_json.md) | Rush ç‰ˆæœ¬è¦†ç›–                                                                               |
| [`pnpm-config.json`](../configs/pnpm-config_json.md)         | PNPM ç‰ˆæœ¬è¦†ç›–                                                                               |
| `pnpm-lock.yaml`                                             | PNPM é”å®šæ–‡ä»¶                                                                               |
| `repo-state.json`                                            | Rush ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºé˜²æ­¢æ‰‹åŠ¨æ›´æ”¹é”å®šæ–‡ä»¶                                               |
| [`.npmrc`](../configs/npmrc.md)                              | åŒ…ç®¡ç†å™¨é…ç½®                                                                                |
| `.pnpmfile-subspace.cjs`                                     | ç¨‹åºåŒ–ç‰ˆæœ¬è¦†ç›–ï¼Œä¸ [`.pnpmfile.cjs`](../configs/pnpmfile_cjs.md) è§„èŒƒä¸€è‡´ï¼Œä½†ç‰¹å®šäºè¯¥å­ç©ºé—´ |

æœ‰äº›æ–‡ä»¶å¯ä»¥å…¨å±€é…ç½®ï¼ˆé€‚ç”¨äºæ•´ä¸ª monorepoï¼‰ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨å­ç©ºé—´çº§åˆ«é…ç½®ï¼š

| å­ç©ºé—´é…ç½®æ–‡ä»¶           | å…¨å±€é…ç½®æ–‡ä»¶                          | ç»§æ‰¿å…³ç³»                                        |
| ------------------------ | ------------------------------------- | ----------------------------------------------- |
| `common-versions.json`   | æ—                                     | å¯ç”¨å­ç©ºé—´æ—¶ç¦æ­¢ä½¿ç”¨å…¨å±€æ–‡ä»¶                    |
| `pnpm-config.json`       | `common/config/rush/pnpm-config.json` | **ï¼ˆä»åœ¨å¼€å‘ä¸­ï¼‰** å­ç©ºé—´ä¼˜å…ˆï¼Œä½†æŸäº›å­—æ®µè¢«å¿½ç•¥ |
| `pnpm-lock.yaml`         | æ—                                     | å¯ç”¨å­ç©ºé—´æ—¶ç¦æ­¢ä½¿ç”¨å…¨å±€æ–‡ä»¶                    |
| `repo-state.json`        | æ—                                     | å¯ç”¨å­ç©ºé—´æ—¶ç¦æ­¢ä½¿ç”¨å…¨å±€æ–‡ä»¶                    |
| `.npmrc`                 | `common/config/rush/.npmrc`           | å­ç©ºé—´è¦†ç›–ä¼˜å…ˆ                                  |
| `.pnpmfile-subspace.cjs` | `common/config/rush/.pnpmfile.cjs`    | å­ç©ºé—´è¦†ç›–ä¼˜å…ˆ                                  |

è¯·æ³¨æ„ä»¥ä¸‹é…ç½®æ–‡ä»¶ä¸ä¼šç§»åŠ¨ï¼š

- `common/config/.npmrc-publish`: è¯¥æ–‡ä»¶ç”¨äº Rush NPM å‘å¸ƒï¼Œæ— è®ºå‘å¸ƒçš„é¡¹ç›®å±äºå“ªä¸ªå­ç©ºé—´
- `common/config/.pnpmfile.cjs`: è¯¥æ–‡ä»¶å¯åº”ç”¨å½±å“ monorepo ä¸­æ‰€æœ‰å­ç©ºé—´çš„ç‰ˆæœ¬è¦†ç›–ã€‚ä¸ºäº†é¿å…è·¨é”å®šæ–‡ä»¶çš„æ··ä¹±äº¤äº’ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æœ€å¥½ä½¿ç”¨ `.pnpmfile-subspace.cjs`ã€‚

æ²¡æœ‰å­ç©ºé—´æ—¶ï¼ŒRush ä¼šåœ¨ `common/temp/` æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆå¹¶å®‰è£… PNPM å·¥ä½œåŒºã€‚å¯ç”¨å­ç©ºé—´åï¼Œå°†åœ¨ç±»ä¼¼ `common/temp/<subspace-name>/` çš„æ–‡ä»¶å¤¹ä¸­åˆ†åˆ«æ‰§è¡Œã€‚

æœ‰ä¸¤ç§åŸºæœ¬æ“ä½œæ¨¡å¼ï¼š

1. **åªæœ‰å‡ ä¸ªå­ç©ºé—´ï¼š** ä½ å¯ä»¥åœ¨ `subspaces.json` ä¸­è®¾ç½® `"preventSelectingAllSubspaces": false`ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ï¼Œ`rush install` å°†å®‰è£…æ‰€æœ‰å­ç©ºé—´ã€‚

2. **å¤§é‡å­ç©ºé—´ï¼š** å¦‚æœå®‰è£…æ‰€æœ‰å­ç©ºé—´ä¼šæ¶ˆè€—è¿‡å¤šçš„æ—¶é—´å’Œç£ç›˜ç©ºé—´ï¼Œé‚£ä¹ˆä½ å¯ä»¥è®¾ç½® `"preventSelectingAllSubspaces": true`ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œè°ƒç”¨ `rush install` æˆ– `rush update` ç­‰å‘½ä»¤æ—¶ï¼Œç”¨æˆ·å¿…é¡»ä»¥æŸç§æ–¹å¼è¿‡æ»¤å­ç©ºé—´ï¼Œä¾‹å¦‚ï¼š
   - ä½¿ç”¨ `rush install --to my-project` åªå®‰è£…æŒ‡å®šé¡¹ç›®çš„ä¾èµ–
   - ä½¿ç”¨ `rush install --subspace my-subspace` åªå®‰è£…ç‰¹å®šå­ç©ºé—´
   - ä½¿ç”¨ [é¡¹ç›®é€‰æ‹©å™¨](../developer/selecting_subsets.md#subspace-members-subspace) ä¸­çš„ `rush install --to subspace:my-subspace` ä¸ºå±äºæŸä¸ªå­ç©ºé—´çš„é¡¹ç›®å®‰è£…

## å¦‚ä½•å¯ç”¨å­ç©ºé—´

1. ç¡®ä¿ä½ çš„ **rush.json** æ–‡ä»¶ä¸­æŒ‡å®š `"rushVersion": "5.122.0"` æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œ`"pnpmVersion": "8.7.6"` æˆ–æ›´æ–°ç‰ˆæœ¬ã€‚

2. ä½¿ç”¨ **subspaces.json** å¯ç”¨æ­¤åŠŸèƒ½å¹¶å®šä¹‰å­ç©ºé—´ã€‚ä½ å¯ä»¥ä» [subspaces.json](../configs/subspaces_json.md) æ–‡æ¡£ä¸­å¤åˆ¶æ­¤æ–‡ä»¶çš„æ¨¡æ¿ï¼Œæˆ–è€…ä½¿ç”¨ `rush init` ç”Ÿæˆå®ƒã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º `install-test` çš„å­ç©ºé—´ï¼Œç”¨äºæµ‹è¯• NPM åŒ…ï¼š

   **common/config/rush/subspaces.json**

   ```json
   {
     "$schema": "https://developer.microsoft.com/json-schemas/rush/v5/subspaces.schema.json",

     /**
      * è®¾ç½®æ­¤æ ‡å¿—ä¸º "true" ä»¥å¯ç”¨å­ç©ºé—´ã€‚
      */
     "subspacesEnabled": false,

     /**
      * å½“æ‰§è¡Œç±»ä¼¼ "rush update" çš„å‘½ä»¤ä¸”æ²¡æœ‰ä½¿ç”¨ "--subspace" æˆ– "--to" å‚æ•°æ—¶ï¼ŒRush ä¼šå®‰è£…æ‰€æœ‰å­ç©ºé—´ã€‚
      * åœ¨æ‹¥æœ‰å¤§é‡å­ç©ºé—´çš„åºå¤§ monorepo ä¸­ï¼Œè¿™æ ·åšä¼šéå¸¸ç¼“æ…¢ã€‚
      * é€šè¿‡å§‹ç»ˆè¦æ±‚é€‰æ‹©å‚æ•°æ¥æ‰§è¡Œç±»ä¼¼ "rush update" ä¹‹ç±»çš„å‘½ä»¤ï¼Œå¯ä»¥è®¾ç½® "preventSelectingAllSubspaces" ä¸º true ä»¥é¿å…æ­¤ç±»é”™è¯¯ã€‚
      */
     "preventSelectingAllSubspaces": false,

     /**
      * å­ç©ºé—´åç§°åˆ—è¡¨ï¼Œåº”ä¸ºå°å†™çš„å­—æ¯æ•°å­—å•è¯å¹¶ç”¨è¿å­—ç¬¦åˆ†éš”ï¼Œä¾‹å¦‚ "my-subspace"ã€‚
      * å¯¹åº”çš„é…ç½®æ–‡ä»¶è·¯å¾„å¯èƒ½ä¸º "common/config/subspaces/my-subspace/package-lock.yaml"ã€‚
      */
     "subspaceNames": [
       // "default" å­ç©ºé—´å³ä½¿ä½ æ²¡æœ‰å®šä¹‰å®ƒä¹Ÿæ€»æ˜¯å­˜åœ¨ï¼Œä½†ä¸ºäº†æ¸…æ™°èµ·è§ï¼Œè®©æˆ‘ä»¬å°†å…¶åŒ…å«åœ¨å†…
       "default",

       "install-test" // ğŸ‘ˆğŸ‘ˆğŸ‘ˆ æˆ‘ä»¬çš„ç¬¬äºŒä¸ªå­ç©ºé—´åç§°
     ]
   }
   ```

3. åˆ›å»º `default` å­ç©ºé—´æ–‡ä»¶å¤¹å¹¶å°†ç°æœ‰é…ç½®æ–‡ä»¶ç§»åŠ¨åˆ°é‚£é‡Œï¼š

   ```bash
   cd my-repo
   mkdir --parents common/config/subspaces/default

   # ç§»åŠ¨è¿™äº›æ–‡ä»¶ï¼š
   mv common/config/rush/common-versions.json  common/config/subspaces/default/
   mv common/config/rush/pnpm-lock.yaml        common/config/subspaces/default/
   mv common/config/rush/.npmrc                common/config/subspaces/default/

   # é‡å‘½åæ­¤æ–‡ä»¶ï¼š
   mv common/config/rush/.pnpmfile.cjs  common/config/subspaces/default/.pnpmfile-subspace.cjs
   ```

4. åˆ›å»º `install-test` å­ç©ºé—´æ–‡ä»¶å¤¹ï¼š

   ```bash
   cd my-repo
   mkdir --parents common/config/subspaces/install-test
   ```

5. é€šè¿‡ç¼–è¾‘ `rush.json` å°†é¡¹ç›®åˆ†é…åˆ°å­ç©ºé—´ã€‚ä¾‹å¦‚ï¼š

   **rush.json**

   ```json
   . . .

     "projects": [
       {
         "packageName": "my-library-test",
         "projectFolder": "test-projects/my-library-test",
         "subspaceName": "install-test"
       }

   . . .
   ```

   å¦‚æœä»»ä½•é¡¹ç›®çœç•¥äº† `"subspaceName"`ï¼Œå®ƒä»¬å°†å±äº `default` å­ç©ºé—´ã€‚

6. ç°åœ¨æ›´æ–°æ–°å­ç©ºé—´çš„é”å®šæ–‡ä»¶ï¼š

   ```bash
   # æ¸…ç†ä¹‹å‰çš„ common/temp æ–‡ä»¶å¤¹
   rush purge

   # é‡æ–°ç”Ÿæˆ "default" å­ç©ºé—´ï¼š
   rush update --full --subspace default

   # é‡æ–°ç”Ÿæˆ "install-test" å­ç©ºé—´ï¼š
   rush update --full --subspace install-test
   ```

   > **æ³¨æ„ï¼š** ä½ å¯ä»¥åœ¨ä¸ä½¿ç”¨ `--full` é‡æ–°ç”Ÿæˆä»»ä½•é”å®šæ–‡ä»¶çš„æƒ…å†µä¸‹è¿ç§»åˆ°å­ç©ºé—´ï¼Œ
   > ä½†è¿™æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„è¿‡ç¨‹ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨è„šæœ¬é‡å†™ `pnpm-lock.yaml` æ–‡ä»¶ä¸­çš„æŸäº›è·¯å¾„ã€‚

## å¦è§

- [subspaces.json](../configs/subspaces_json.md) é…ç½®æ–‡ä»¶
- [rfc-4230-rush-subspaces.md](https://github.com/microsoft/rushstack/blob/main/common/docs/rfcs/rfc-4230-rush-subspaces.md)ï¼šæ­¤åŠŸèƒ½çš„åŸå§‹è§„èŒƒï¼Œå…¶ä¸­æ›´è¯¦ç»†åœ°è§£é‡Šäº†åŠ¨æœºå’Œè®¾è®¡
